### <a name="_b7urdng99y53"></a>**Название задачи:** 
Архитектурное решение для автоматической передачи ставок по депозитам из АБС в систему кол-центра

### <a name="_hjk0fkfyohdk"></a>**Автор:**
Команда цифровой трансформации банка "Стандарт"

### <a name="_uanumrh8zrui"></a>**Дата:**
15 августа 2025

### <a name="_3bfxc9a45514"></a>**Функциональные требования**
Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

|**№**|**Действующие лица или системы**      |**Use Case**                   |**Описание**                                                   |
| :-: | :- | :- | :- |
| UC1 | АБС, API-шлюз                        | Изменение ставок в АБС        | Сотрудник бэк-офиса изменяет ставки по депозитам в АБС        |
| UC2 | АБС, API-шлюз                        | Обнаружение изменений         | API-шлюз обнаруживает изменения ставок в АБС через polling    |
| UC3 | API-шлюз, Rates Service              | Передача данных о ставках     | API-шлюз передает обновленные ставки в Rates Service          |
| UC4 | Rates Service, Cache                 | Кэширование ставок            | Rates Service сохраняет ставки в кэш для быстрого доступа     |
| UC5 | Rates Service, Call Center API       | Передача ставок в кол-центр   | Rates Service передает актуальные ставки в систему кол-центра |
| UC6 | Call Center API, PostgreSQL          | Сохранение ставок             | Call Center API сохраняет ставки в базу данных кол-центра     |
| UC7 | Call Center UI, Call Center API      | Отображение ставок операторам | Операторы кол-центра видят актуальные ставки в интерфейсе     |
| UC8 | Call Center API, Partner Call Center | Передача данных партнеру      | Система передает ставки в партнерский кол-центр через SFTP    |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Опишите здесь нефункциональные требования и архитектурно значимые требования.

|**№**|**Требование**                                              |
| :-: | :- |
| NFR1 | Время передачи ставок из АБС в кол-центр не более 5 минут |
| NFR2 | Доступность системы передачи ставок 99.9%                 |
| NFR3 | Шифрование данных при передаче между системами            |
| NFR4 | Логирование всех операций передачи ставок                 |
| NFR5 | Возможность отката к предыдущей версии ставок             |
| NFR6 | Мониторинг состояния интеграции в реальном времени        |
| NFR7 | Обработка до 1000 изменений ставок в день                 |
| NFR8 | Совместимость с существующими версиями АБС                |

### <a name="_qmphm5d6rvi3"></a>**Решение**
Приведите диаграммы контекста и контейнеров в модели C4. Опишите там основные компоненты и интеграции всех элементов решения.

**Логика принятия решений:**

1. **Принцип минимальной нагрузки на АБС:** Выбран polling механизм вместо push-уведомлений, чтобы не перегружать устаревшую АБС.

2. **Кэширование для производительности:** Redis используется для кэширования ставок, что обеспечивает быстрый доступ и снижает нагрузку на АБС.

3. **Асинхронная обработка:** SFTP Gateway обеспечивает асинхронную передачу данных партнерам, не блокируя основной поток.

4. **Безопасность передачи:** Выбран SFTP для передачи данных партнерам, обеспечивая шифрование и аутентификацию.

5. **Мониторинг и отказоустойчивость:** Monitoring Service обеспечивает контроль состояния интеграции и возможность отката.

**Основные компоненты архитектуры:**

1. **API Gateway** - обеспечивает безопасную интеграцию между АБС и внешними системами, реализует polling механизм
2. **Rates Service** - обрабатывает и кэширует ставки по депозитам, обеспечивает версионирование данных
3. **Cache (Redis)** - обеспечивает быстрый доступ к ставкам и снижает нагрузку на АБС
4. **SFTP Gateway** - обеспечивает безопасную передачу данных партнерам через SFTP протокол
5. **Monitoring Service** - контролирует состояние интеграции и обеспечивает алерты

**Диаграммы C4:**

1. **Диаграмма контекста** показывает взаимодействие системы передачи ставок с внешними акторами (сотрудники бэк-офиса, операторы кол-центра, операторы партнерского кол-центра) и внешними системами (АБС, система кол-центра, партнерский кол-центр).

2. **Диаграмма компонентов** детализирует внутреннюю структуру системы передачи ставок:
   - **Rates Service** - основной сервис обработки ставок (Java Spring Boot)
   - **Cache (Redis)** - кэширование ставок для быстрого доступа
   - **API Gateway** - интеграция с АБС через polling (Spring Cloud Gateway)
   - **SFTP Gateway** - передача данных партнерам (Apache Camel)
   - **Monitoring Service** - мониторинг состояния интеграции (Prometheus + Grafana)

Диаграммы представлены в файлах Context_Diagram_CallCenter.drawio и Component_Diagram_CallCenter.drawio.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**
Опишите здесь наиболее важные альтернативные решения.

**Альтернатива 1: Прямая интеграция АБС с кол-центром через базу данных**
- **Описание:** Прямое подключение системы кол-центра к базе данных АБС
- **Плюсы:** Простота реализации, минимальная задержка передачи данных
- **Минусы:** Высокие риски безопасности, зависимость от структуры БД АБС, сложность поддержки, нарушение принципов архитектуры

**Альтернатива 2: Использование файлового обмена вместо API**
- **Описание:** Передача ставок через файлы (CSV, XML) с периодическим обменом
- **Плюсы:** Простота реализации, совместимость с устаревшими системами
- **Минусы:** Высокая задержка (часы), сложность обработки ошибок, проблемы с синхронизацией

**Альтернатива 3: Реализация через message queue (Kafka/RabbitMQ)**
- **Описание:** Использование очередей сообщений для асинхронной передачи ставок
- **Плюсы:** Высокая производительность, отказоустойчивость, масштабируемость
- **Минусы:** Сложность интеграции с устаревшей АБС, высокая стоимость инфраструктуры, избыточность для простого случая

**Недостатки, ограничения, риски**

Подробно опишите здесь недостатки, ограничения и риски выбранного решения.

**Недостатки:**
- Сложность интеграции с устаревшей АБС на Delphi/Oracle
- Необходимость поддержки polling механизма вместо push-уведомлений
- Зависимость от производительности Redis для кэширования
- Ограниченная масштабируемость при высокой частоте изменений ставок
- Сложность отладки асинхронных процессов передачи данных

**Ограничения:**
- Временные ограничения на передачу данных (5 минут)
- Необходимость использования существующих технологий (Java Spring Boot, Redis)
- Бюджетные ограничения на разработку и инфраструктуру
- Ограничения по частоте polling запросов к АБС
- Необходимость совместимости с существующими версиями АБС

**Риски:**
- Риск перегрузки АБС при высокой частоте polling запросов
- Риск потери данных при сбоях в сети между компонентами
- Риск несогласованности данных между АБС и кэшем Redis
- Риск проблем с производительностью при большом объеме данных
- Риск сложности интеграции с партнерскими системами через SFTP
- Риск проблем с безопасностью при передаче данных между системами
